<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
    <meta charset="UTF-8">
    <title>散煤</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <link rel="shortcut icon" type="image/x-icon" th:href="@{/favicon.ico}"/>
    <link rel="stylesheet" th:href="@{/lib/layui/css/layui.css}">
    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/animate.min.css}">
</head>

<body>

<div class="page-loading">
    <div class="rubik-loader"></div>
</div>
    <form class="layui-form ">
        <div class="layui-show" style="margin-left:30px;margin-top: 2px;margin-bottom: 2px">
            <div class="layui-input-inline">
                <div class="layui-input-inline">
                    <input type="text" class="layui-input" id="year" name="year" placeholder="年份">
                </div>
            </div>
            <div class="layui-input-inline">
                <select id="cityCode" name="cityCode" lay-filter="cityCode">
                    <option value="">请选择实际城市</option>
                    <option th:each="city : ${citys}" th:value="${city.cityCode}" th:text="${city.cityName}">
                    </option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select id="countyId" name="countyId" lay-filter="countyId">
                    <option value="">请选择实际区县</option>
                    <option th:each="county : ${countys}" th:value="${county.countyId}" th:text="${county.countyName}">
                    </option>
                </select>
            </div>
            <button  id="selectcoal" type="button" class="layui-btn" lay-submit lay-filter="search" data-type="reload">
                <i class="layui-icon">&#xe615;</i></button>
        </div>
    </form>
    <div class="layui-colla-content layui-show">
        <table class="layui-hide" id="coal-tab" lay-filter="coal-tab"></table>
    </div>


<!--</div>-->

<script th:src="@{/lib/jquery/jquery.min.js}"></script>
<script th:src="@{/lib/layui/layui.js}"></script>
<script th:src="@{/js/common.js}"></script>
<script type="text/html" id="toolbar">
    <shiro:hasPermission name="source:fixed:delete">
        <a class="layui-btn layui-btn-blue" lay-event="add"><i class="layui-icon layui-icon-add-circle"></i>新增</a>
    </shiro:hasPermission>
</script>
<script type="text/html" id="column-toolbar">
    <shiro:hasPermission name="source:fixed:delete">
        <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    </shiro:hasPermission>
    <shiro:hasPermission name="source:fixed:delete">
        <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
    </shiro:hasPermission>
</script>
<script>
    layui.use(['table','form', 'element'], function () {
        var table = layui.table //表格
            ,form = layui.form //form表单
            ,element = layui.element
        table.render({
            elem: '#coal-tab'
            , url: '/source/fixed/coal/list'
            , page: true
            , toolbar: '#toolbar'
            , cols: [
                [
                    {field: 'year',sort:true, title: '年份'}
                    , {field: 'cityName', title: '城市'}
                    , {field: 'countyName', title: '区县'}
                    , {field: 'activityLevel', title: '活动水平'}
                    , {field: 'activityLevelNum', title: '活动水平数量'}
                    , {field: 'fuelMeteringUnit', title: '活动水平单位'}
                    , {field: 'sourceDescription', title: '基本信息'}
                    , {field: 'pm25Emission', title: 'PM2.5'}
                    , {field: 'pm10Emission', title: 'PM10'}
                    , {field: 'coEmission', title: 'CO'}
                    , {field: 'ocEmission', title: 'OC'}
                    , {field: 'bcEmission', title: 'BC'}
                    , {field: 'vocEmission', title: 'VOC'}
                    , {field: 'so2Emission', title: 'SO2'}
                    , {field: 'noxEmission', title: 'NOX'}
                    , {field: 'nh3Emission', title: 'NH3'}
                    , {title: '操作', width: "10%", fixed: 'right', align: 'center', toolbar: '#column-toolbar'}
                ]
            ]
            ,page: true   //开启分页
            ,limit:50   //默认十条数据一页
            ,limits:[50,100,200]  //数据分页条
        });
        // 行点击事件 重置密码
        table.on('tool', function (obj) {
            var data = obj.data;
            var event = obj.event;
            if (event == 'del') {
                del(obj);
            }
            if (event == 'edit') {
                edit(obj);
            }
        });
        // 工具条点击事件
        table.on('toolbar', function (obj) {
            var data = obj.data;
            var event = obj.event;
            if (event == 'add') {
                add(obj);
            }
        });
        function edit(obj) {
            var data = obj.data;
            var url = '/source/fixed/coal/' + data.id;
            openTab('编辑-散煤',url);
        }
        function add(obj) {
            var url = '/source/fixed/coal/add';
            openTab('新增-散煤',url);
        }
        function del(obj) {
            layer.confirm("确定删除吗?", {icon: 3, title: '提示'},
                function (index) {// 确定回调
                    var id = obj.data.id;
                    $.post('/source/fixed/coal/' + id, {_method: "DELETE"}, function (data) {
                        layer.close(index);
                        handlerResult(data, deleteDone);
                    });
                }, function (index) {//取消回调
                    layer.close(index);
                }
            );
        }
        function deleteDone(data) {
            parent.layer.msg("删除成功", {icon: 6});
            refresh();
        }
        function refresh() {
            table.reload("coal-tab");
        }
        //监听提交 lay-filter="search"
        form.on('submit(search)', function(data){
            var formData = data.field;
            var countyId = formData.countyId,
                cityCode=formData.cityCode,
                year=formData.year
            //执行重载
            table.reload('coal-tab',{
                where: {
                    countyId: countyId,
                    cityCode:cityCode,
                    year:year
                }
            });
            return false;//false：阻止表单跳转  true：表单跳转
        });
    });

</script>

</body>

</html>